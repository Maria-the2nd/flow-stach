# Flow Bridge — Authoritative Current-State Specification

Version: 2026-01-24

This document is the canonical, present-tense specification of how the system works now. It supersedes conflicting or older documentation. When evidence conflicts, the chosen behavior is explicitly stated and the alternative is listed in the Deprecation Appendix.

---

# 1) System Overview

Flow Bridge is a web application for people who want access to high-quality templates, components, and tools that accelerate design and development in the age of AI. The system addresses the gap between fast AI-generated outputs and the need for precise, human-driven refinement by providing reusable assets and tools that bring work into Webflow for fine-tuning.

The system serves two user-facing purposes:
- A conversion tool (HTML to Webflow) that imports a single HTML bundle, extracts tokens/components/artifacts, and provides Webflow-copyable payloads.
- A marketplace-style catalog (Explore) that previews templates, components, and tools (currently mock/static data).

Marketplace templates and components are the public supply; when acquired, they appear in the user’s library surfaces for copying into Webflow.

Needs Confirmation:
- The current production scope for marketplace purchasing and fulfillment is not implemented in the UI; the catalog is a static preview only.

---

# 2) Core Mental Model (CRITICAL)

## Primary Objects
- User: Authenticated identity (Clerk) that owns import projects and related data.
- Import Project: A single imported HTML bundle owned by a user. It is the top-level container for artifacts and derived components.
- Import Artifact: Extracted data from an import project (CSS, HTML, scripts, tokens, external libraries, etc.).
- Marketplace Template: A reusable full-page asset offered in the public catalog/library for purchase or acquisition (purchase flow not implemented in current UI).
- Marketplace Component: A reusable component offered in the public catalog/library for purchase or acquisition (purchase flow not implemented in current UI).
- Extracted Component: A section/component extracted from a user’s imported HTML, stored as an Asset + Payload for reuse and copy to Webflow within that user’s workspace.
- Style Guide (Design Tokens): The visual, copyable representation of extracted design tokens (colors, typography, spacing, radius, shadows). This is the single term used for the tokens UI and Webflow copy payload.
- Site Structure Payload: A Webflow payload that represents the full site layout with base layout styles only (layout, positioning, spacing, display, flex/grid), excluding colors/typography and excluding styles already covered by the Style Guide (Design Tokens) or Embeds.
- Asset: A reusable, cataloged item (component/template/tokens) stored in the library tables; it may be created by marketplace supply, imports, or admin tooling.
- Template: A grouping entity for assets (e.g., all components generated by a single import project).
- Payload: The Webflow JSON and/or code payload data attached to an Asset.
- Favorite: A user-specific marker for an Asset (used by the Asset Vault UI, which is not currently linked from navigation).

## Relationships
- A User owns many Import Projects.
- Each Import Project has many Import Artifacts.
- Each Import Project maps to one Template (same slug) in the library layer.
- Each Extracted Component becomes an Asset linked to the Template, with a Payload for Webflow copy.
- Design token data is stored on the Import Project for quick access and also appears in artifacts (`tokens_json`, `tokens_css`).
- The Style Guide (Design Tokens) is generated from project artifacts (CSS) at view time; it is not stored as a persistent record.
- The Site Structure Payload is generated from project components at view time and includes only base layout styles that are not represented by the Style Guide or Embeds.
- Marketplace Components and Templates live in the public catalog; extracted components live in the user’s workspace context.
- User-owned marketplace items appear in the user’s library surfaces (Templates and Components).

## Naming Guardrail (to prevent confusion)
- Use “Marketplace Templates/Components” for items in the public catalog or purchased library.
- Use “Imported Projects” and “Extracted Components” for user-owned outputs created by the import tools.
- Do not call extracted components “library components” in user-facing or technical documentation.

## Explicit Exclusions (Not Objects)
- No concept of Teams, Roles beyond user/admin, or shared project ownership.
- No concept of Purchases/Orders/Payments in the current UI.
- No concept of Live Sync to Webflow or Webflow API integration.
- No concept of a multi-file project structure; the importer treats input as a single HTML payload.
- No concept of public visibility or sharing for imported projects.

---

# 3) User Journeys (Happy Path First)

## First-Time User
1) Visit `/explore` and browse static templates/components/tools.
2) Sign up via `/sign-up` and authenticate.
3) (If purchasing is enabled) Acquire a template or component; it appears in the user’s library surfaces.
4) Navigate to `/workspace/import` and upload a single HTML file (or ZIP treated as text).
5) The importer processes the HTML, generates components/tokens/artifacts, and stores them in the user’s workspace.
6) Open the new project at `/workspace/projects/[id]` and use:
   - Overview: token summary and font checklist
   - Style Guide (Design Tokens): visual tokens + Webflow copy
   - Site: copy individual components and the Site Structure Payload (full layout with base styles only)
   - Embeds: copy CSS/JS and external library tags
7) Paste into Webflow Designer in this order: Style Guide (Design Tokens) → Embeds → Site Structure or individual components.

Needs Confirmation:
- Marketplace purchase/ownership flow and fulfillment into user libraries are not implemented in the current UI.
- ZIP input is accepted by the UI but is read as raw text; actual ZIP parsing is not implemented.

## Returning User
1) Sign in and open `/workspace/projects`.
2) See existing imports with thumbnails and component counts.
3) Open a project and copy Style Guide (Design Tokens), Embeds, and then the Site Structure or individual components to Webflow.
4) Optionally update the project thumbnail or delete the project.

## Power User
1) Import multiple projects and use the Style Guide (Design Tokens) export to create Webflow style guide pages.
2) Use the Embeds tab to register external libraries in Webflow project settings.
3) Use “Clear All Projects” to remove all imports and their derived assets/payloads.
4) (Admin only) Use `/admin/*` tools for bulk import/seed workflows.

Needs Confirmation:
- Admin tools are internal only and are not part of the primary user journey.

---

# 4) Product Surfaces

## Public / Marketplace
- `/` → redirects to `/explore`
- `/explore` → public catalog with Tabs: Templates, Components, Tools (static mock data)
- `/sign-in`, `/sign-up` → authentication
- `/extension` → Chrome extension installation instructions
- `/flow-bridge` → redirects to `/explore`

## Authenticated / User Workspace
- `/workspace/projects` → list of user import projects
- `/workspace/projects/[id]` → project details with tabs: Overview, Style Guide (Design Tokens), Site, Images, Embeds
- `/workspace/import` → import tool (single file)
- `/workspace/library` → templates library (mock data)
- `/workspace/components` → components library (mock data)
- `/account` → Clerk user profile

## Authenticated / Internal or Legacy
- `/assets/[slug]` → asset detail page (requires auth, no list page)
- `/assets` → redirects to `/workspace/projects` (legacy route)
- `/admin/*` → internal/admin import and seed tooling

## Tools vs Assets vs Imports
- Tools: Import pipeline, Style Guide (Design Tokens) export, Site Structure Payload export, clipboard copy/validation.
- Assets: Reusable components/templates/tokens stored in `assets` + `payloads` (either marketplace or import-derived).
- Imports: User-owned projects stored in `importProjects` + `importArtifacts` (private to the user).

---

# 5) Data & Asset Taxonomy

Each item states ownership, storage, creation, and reuse.

## Marketplace Templates (Public Catalog)
- Owner: System
- Storage: Static mock data in `components/explore/mock-data.ts`
- Created: Curated in code (not from database)
- Reuse: Display-only in current UI; purchase and ownership are not implemented (Needs Confirmation)

## Owned Templates (Workspace Library)
- Owner: User (conceptually)
- Storage: Currently mock data in `app/(authenticated)/workspace/library/page.tsx`
- Created: Not implemented; UI uses mock data (Needs Confirmation)
- Reuse: UI-only; copy or seeding flows are not implemented (Needs Confirmation)
- Needs Confirmation: Purchase flow and storage mapping into `templates` + `assets`

## Owned Components (Workspace Components)
- Owner: User (conceptually)
- Storage: Currently mock data in `app/(authenticated)/workspace/components/page.tsx`
- Created: Not implemented; UI uses mock data (Needs Confirmation)
- Reuse: UI-only; copy flow is not implemented (Needs Confirmation)
- Needs Confirmation: Purchase flow and storage mapping into `assets` + `payloads`

## Imported Sites (Import Projects)
- Owner: User (Clerk ID)
- Storage: `importProjects` (Convex)
- Created: `/workspace/import` → `processProjectImport` → `api.import.importProject`
- Reuse: Project detail UI and Webflow copy actions

## Extracted Components (From Imports)
- Owner: User
- Storage: `assets` + `payloads`, linked via a Template with the same slug as the import project
- Created: During import; each component yields an Asset + Payload
- Reuse: Project detail component list and component-level copy actions
- Notes: These are private to the user and are not part of the public marketplace catalog.

## Extracted Artifacts (From Imports)
- Owner: User
- Storage: `importArtifacts`
- Created: During import (tokens, CSS, HTML, scripts, external libraries, etc.)
- Reuse: Style Guide (Design Tokens), Embeds, and copy flows

## Generated Artifacts (On-Demand)
- Owner: User
- Storage: Not persisted; generated at view time
- Created: Style Guide (Design Tokens) Webflow payload via `generateStyleGuidePayload`
- Created: Site Structure Payload (full layout with base styles only) generated from project components
- Reuse: Clipboard export to Webflow

## Marketplace Assets (Admin-Seeded or Imported)
- Owner: System (or admin)
- Storage: `assets`, `templates`, `payloads`
- Created: Admin import flows or seed scripts
- Reuse: Asset detail pages and internal Asset Vault UI (not linked from public navigation)

---

# 6) Import & Transformation Pipeline

## Inputs
- Single HTML file (or ZIP treated as raw text).
- HTML can include `<style>` and `<script>` blocks.
- External script tags are detected and stored as library URLs.

## Processing Stages
1) Parsing
   - Strip `<style>` and `<script>` tags from HTML.
   - Extract CSS, inline scripts, and external script URLs.
   - Remove inline styles, inline event handlers, and iframes.
2) Extracting
   - Parse CSS into a class index.
   - Extract design tokens from CSS variables.
   - Extract images and font metadata.
3) Componentizing
   - Split normalized HTML into components/sections.
   - Apply deterministic component naming.
4) Semantic Patching (Optional LLM)
   - If unresolved variables or structural warnings exist, call `/api/flowbridge/semantic`.
   - LLM may rename components and patch HTML/CSS.
   - If LLM is unavailable, a mock fallback is used.
5) Generating
   - Literalize CSS (resolve CSS variables).
   - Generate Style Guide (Design Tokens) Webflow payload and per-component Webflow JSON.
   - Generate Site Structure Payload that includes base layout styles and excludes styles already provided by the Style Guide or Embeds.
   - Persist project, artifacts, assets, and payloads.

## Outputs
- `importProjects` record (user-owned)
- `importArtifacts` records:
  - `tokens_json`, `tokens_css`, `styles_css`, `class_index`, `clean_html`
  - `scripts_js`, `js_hooks`, `external_scripts`
  - `token_webflow_json`, `component_manifest`
- `templates` record (slug matches project slug)
- `assets` + `payloads` for each component (and tokens asset if available)
- Site Structure Payload (generated on demand; not stored)

## Preserved vs Normalized vs Discarded
Preserved:
- HTML structure (as cleaned body content)
- CSS rules (after normalization and literalization)
- Inline script content
- External script URLs
- Image references

Normalized:
- HTML converted to class-based structure for Webflow compatibility
- Void elements normalized to self-closing syntax
- CSS variables resolved to literal values (as much as possible)
- Gradients and selectors sanitized for Webflow
 - Full-site structure payload includes base layout styles only and excludes Style Guide or Embed styles

Discarded:
- Inline styles on elements
- Inline event handlers (e.g., `onclick=`)
- `<iframe>` content
- `<head>`/`<html>`/`<body>` wrappers
- External stylesheet link tags (converted to artifacts only)

Needs Confirmation:
- ZIP extraction is not implemented; ZIP input is read as text.

---

# 7) Technical Architecture (High Level)

## Frontend Responsibilities
- Next.js App Router UI for Explore, Workspace, Import, Project Details, and Style Guide (Design Tokens).
- Client-side import processing via `processProjectImport`.
- Clipboard export with preflight validation/sanitization.
- Optional Chrome extension integration for clipboard writes.
- Authentication UI via Clerk.

## Backend Responsibilities
- Convex functions for:
  - Import project persistence (`importProjects`, `importArtifacts`)
  - Asset, template, payload storage (`assets`, `templates`, `payloads`)
  - Project listing, deletion, thumbnails
  - Favorites (library UI)
- Next.js API routes:
  - `/api/flowbridge/semantic` → LLM semantic patching via OpenRouter
  - `/api/webflow/convert` → validation/sanitization pipeline for Webflow payloads

## Storage Responsibilities
- Convex database for structured data.
- Convex file storage for project and asset thumbnails.
- All project data is scoped by `userId` (Clerk subject).

## Clipboard / Export Responsibilities
- Validate and sanitize Webflow payloads before copy.
- Prefer ClipboardItem API (`application/json` + `text/plain`).
- Use the Chrome extension when available for system clipboard compatibility.
- Provide fallback document-based copy if needed.
- Use a single “Style Guide (Design Tokens)” copy action; do not expose separate “Design Tokens” vs “Style Guide” copy paths.
- The copy order is Style Guide → Embeds → Site Structure or individual components.
- Site Structure Payload includes only base layout styles; color/typography remain in the Style Guide or Embeds.

---

# 8) Explicit Non-Goals

- No built-in payments, checkout, or license enforcement.
- No live Webflow API integration or project synchronization.
- No collaborative editing or team workspaces.
- No multi-file or full-site ZIP parsing (beyond raw text read).
- No WYSIWYG editing of extracted components in-app.
- No React/TypeScript/Tailwind import support in the user-facing importer.
- No automatic installation of external libraries in Webflow.
- No full-site package copy that duplicates styles already provided by the Style Guide or Embeds.

---

# 9) Deprecation Appendix (MANDATORY)

| Deprecated concept / feature | Where it appeared | Why it’s deprecated | Replacement (if any) |
|---|---|---|---|
| “/ is a landing page” | SYSTEM_MANIFEST.md, README.md | Current routing redirects `/` to `/explore`. The live route defines behavior. | `/` redirects to `/explore` |
| “Inter is the primary typography” | SYSTEM_MANIFEST.md | The app loads Plus Jakarta Sans + Antonio + Geist Mono in `app/layout.tsx`. | Plus Jakarta Sans (sans), Antonio (display), Geist Mono (mono) |
| “Marketplace is only a mock preview and not part of the product” | Inferred from mock UI state | The marketplace is a core product surface; mock data is an implementation placeholder. | Marketplace with purchasable templates/components that populate user libraries |
| “Assets list page at /assets is the primary library entry” | Legacy route assumptions | `/assets` redirects to `/workspace/projects`; asset list UI is not linked from navigation. | Use `/explore` (public) or `/workspace/*` (authenticated) |
| “Multi-file import is supported” | docs/README.md, docs/cli-prompts/* | The user import UI disables multi-file and processes only a single file. | Single-file HTML import only |
| “Admin tools are the main user import surface” | Older docs and admin UIs | The primary user import is `/workspace/import`; admin routes are internal. | `/workspace/import` for users; `/admin/*` for internal use |
| “Three-output system is the user-facing import output model” | docs/three-output-system.md | Current user import UI surfaces raw CSS/JS embeds and Webflow JSON without a distinct three-output UI. | Artifacts in project detail (Embeds tab + Webflow copy) |
| “Flow Stach is the current product name” | Legacy docs and repo history | The product is now named Flow Bridge. | Flow Bridge |
| “Design Tokens” and “Style Guide” are separate concepts | Previous wording in this doc and older UI copy | The Style Guide is the visual representation of design tokens and is the only term used. | Style Guide (Design Tokens) |
| “Full Site Package copy is a primary workflow” | Current project detail UI and older docs | The workflow is Style Guide + Embeds + Site Structure or components; no full-site package with duplicated styles. | Site Structure Payload + component copy |

---

Needs Confirmation (Global):
- Marketplace purchasing, licensing, or user-owned asset delivery.
- ZIP parsing support in the import UI.
- Whether `/assets/[slug]` is for public access or internal only.
